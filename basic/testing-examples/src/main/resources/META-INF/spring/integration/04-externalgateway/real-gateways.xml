<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="https://www.springframework.org/schema/beans"
	xmlns:xsi="https://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="https://www.springframework.org/schema/context"
	xmlns:int="https://www.springframework.org/schema/integration"
	xmlns:int-http="https://www.springframework.org/schema/integration/http"
	xmlns:int-mail="https://www.springframework.org/schema/integration/mail"
	xmlns:int-ws="https://www.springframework.org/schema/integration/ws"
	xsi:schemaLocation="https://www.springframework.org/schema/integration/http https://www.springframework.org/schema/integration/http/spring-integration-http.xsd
		https://www.springframework.org/schema/integration/ws https://www.springframework.org/schema/integration/ws/spring-integration-ws.xsd
		https://www.springframework.org/schema/integration/mail https://www.springframework.org/schema/integration/mail/spring-integration-mail.xsd
		https://www.springframework.org/schema/integration https://www.springframework.org/schema/integration/spring-integration.xsd
		https://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd
		https://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">
	
    <int-http:outbound-gateway id="trafficService" 
	                  url="https://local.yahooapis.com/MapsService/V1/trafficData?appid=YdnDemo&amp;zip={zipCode}" 
		              request-channel="trafficRequestChannel"
		              reply-channel="trafficResponseChannel" 
		              http-method="GET" 
		              message-converters="trafficConverter"
		              expected-response-type="org.springframework.integration.samples.testing.externalgateway.Traffic">
		<int-http:uri-variable name="zipCode" expression="payload"/>
	</int-http:outbound-gateway>
	
	<int-ws:header-enricher id="soapHeaderEnricher"
						    input-channel="weatherRequestChannel"
		                    output-channel="weatherServiceChannel">
		<int-ws:soap-action value="https://ws.cdyne.com/WeatherWS/GetCityWeatherByZIP" />
	</int-ws:header-enricher>

	<int:channel id="weatherServiceChannel" />
	
	<int-ws:outbound-gateway id="weatherService" 
							 request-channel="weatherServiceChannel"
					  		 reply-channel="weatherResponseChannel" 			 
					  		 marshaller="marshaller"
					  		 unmarshaller="marshaller"
					  		 uri="https://ws.cdyne.com/WeatherWS/Weather.asmx"/> 

	<int:channel id="weatherResponseChannel"/>

	<bean id="trafficConverter" class="org.springframework.integration.samples.testing.externalgateway.TrafficHttpConverter"/>
	
	<bean id="marshaller" class="org.springframework.integration.samples.testing.externalgateway.WeatherMarshaller"/>			    

</beans>
